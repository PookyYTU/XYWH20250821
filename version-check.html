<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡å™¨æ–‡ä»¶ç‰ˆæœ¬æ£€æŸ¥ - å°é›¨å¾®å¯’</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
        }
        .status-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #cbd5e0;
        }
        .status-card.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        .status-card.error {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        .status-card.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        .check-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .check-button:hover {
            background: #3182ce;
        }
        .check-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        .version-info {
            font-family: 'Courier New', monospace;
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .instructions {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .file-list li:last-child {
            border-bottom: none;
        }
        .file-status {
            float: right;
            font-weight: bold;
        }
        .file-status.updated {
            color: #48bb78;
        }
        .file-status.outdated {
            color: #f56565;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æœåŠ¡å™¨æ–‡ä»¶ç‰ˆæœ¬æ£€æŸ¥</h1>
        
        <div class="status-card">
            <h3>ğŸ“‹ æ£€æŸ¥è¯´æ˜</h3>
            <p>æ­¤å·¥å…·ç”¨äºæ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ˜¯å¦å·²æ›´æ–°ä¸ºä¿®å¤ç‰ˆæœ¬ã€‚</p>
            <p>å¦‚æœæ˜¾ç¤º"æ—§ç‰ˆæœ¬"ï¼Œè¯·æŒ‰ç…§ã€ŠæœåŠ¡å™¨æ–‡ä»¶æ›´æ–°æŒ‡å—.mdã€‹ä¸Šä¼ æœ€æ–°æ–‡ä»¶ã€‚</p>
        </div>

        <div class="status-card" id="overallStatus">
            <h3>ğŸ¯ æ•´ä½“çŠ¶æ€</h3>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ£€æŸ¥...</p>
        </div>

        <div style="text-align: center;">
            <button class="check-button" onclick="checkAllFiles()">ğŸ”„ æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶</button>
            <button class="check-button" onclick="checkTimeCounter()">â° æµ‹è¯•æ—¶å…‰è®¡æ•°å™¨</button>
            <button class="check-button" onclick="checkAPI()">ğŸ”— æµ‹è¯•APIè¿æ¥</button>
        </div>

        <div class="status-card">
            <h3>ğŸ“ æ–‡ä»¶ç‰ˆæœ¬çŠ¶æ€</h3>
            <ul class="file-list" id="fileList">
                <li>scripts/main.js <span class="file-status" id="mainjs-status">æœªæ£€æŸ¥</span></li>
                <li>scripts/api-data.js <span class="file-status" id="apidata-status">æœªæ£€æŸ¥</span></li>
                <li>index.html <span class="file-status" id="indexhtml-status">æœªæ£€æŸ¥</span></li>
                <li>debug.html <span class="file-status" id="debughtml-status">æœªæ£€æŸ¥</span></li>
            </ul>
        </div>

        <div class="status-card" id="testResults">
            <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•ç»“æœ</h3>
            <div id="testOutput">ç‚¹å‡»æµ‹è¯•æŒ‰é’®æŸ¥çœ‹ç»“æœ...</div>
        </div>

        <div class="instructions">
            <h3>ğŸ“– å¦‚ä½•æ›´æ–°æ–‡ä»¶</h3>
            <p><strong>1. å¦‚æœæ˜¾ç¤º"æ—§ç‰ˆæœ¬"ï¼š</strong></p>
            <ul>
                <li>ä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†åŠŸèƒ½</li>
                <li>å¯¼èˆªåˆ° <code>/www/wwwroot/xiaoyuweihan/</code></li>
                <li>ä¸Šä¼ å¯¹åº”çš„æœ€æ–°æ–‡ä»¶ï¼Œè¦†ç›–åŸæ–‡ä»¶</li>
            </ul>
            <p><strong>2. ä¸Šä¼ å®Œæˆåï¼š</strong></p>
            <ul>
                <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+F5)</li>
                <li>é‡æ–°è¿è¡Œæ­¤æ£€æŸ¥</li>
                <li>è®¿é—®ä¸»ç½‘ç«™éªŒè¯åŠŸèƒ½</li>
            </ul>
        </div>
    </div>

    <script>
        // é¢„æœŸçš„ç‰ˆæœ¬æ ‡è¯†
        const expectedVersions = {
            'main.js': 'æ—¶å…‰è®¡æ•°å™¨è®¾ç½®å®Œæˆ',
            'api-data.js': 'æ•°æ®ç®¡ç†å™¨å·²æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ',
            'index.html': 'api-data.js',
            'debug.html': 'waitForServices'
        };

        async function checkFileVersion(fileName, expectedMarker) {
            try {
                const response = await fetch(`./${fileName}?t=${Date.now()}`, {
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    return { status: 'error', message: `HTTP ${response.status}` };
                }
                
                const content = await response.text();
                const hasMarker = content.includes(expectedMarker);
                
                return {
                    status: hasMarker ? 'updated' : 'outdated',
                    message: hasMarker ? 'æœ€æ–°ç‰ˆæœ¬' : 'æ—§ç‰ˆæœ¬',
                    found: hasMarker
                };
            } catch (error) {
                return { status: 'error', message: error.message };
            }
        }

        async function checkAllFiles() {
            const overallStatus = document.getElementById('overallStatus');
            overallStatus.innerHTML = '<h3>ğŸ”„ æ­£åœ¨æ£€æŸ¥...</h3><p>è¯·ç¨å€™...</p>';
            
            let allUpdated = true;
            let results = [];

            for (const [file, marker] of Object.entries(expectedVersions)) {
                const result = await checkFileVersion(file, marker);
                const statusElement = document.getElementById(file.replace('.', '').replace('/', '') + '-status');
                
                if (result.status === 'updated') {
                    statusElement.textContent = 'âœ… æœ€æ–°ç‰ˆæœ¬';
                    statusElement.className = 'file-status updated';
                } else {
                    statusElement.textContent = 'âŒ ' + result.message;
                    statusElement.className = 'file-status outdated';
                    allUpdated = false;
                }
                
                results.push({ file, ...result });
            }

            // æ›´æ–°æ•´ä½“çŠ¶æ€
            if (allUpdated) {
                overallStatus.innerHTML = `
                    <h3>âœ… æ‰€æœ‰æ–‡ä»¶å·²æ›´æ–°</h3>
                    <p>æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼å¯ä»¥æ­£å¸¸ä½¿ç”¨ç½‘ç«™åŠŸèƒ½ã€‚</p>
                `;
                overallStatus.className = 'status-card success';
            } else {
                overallStatus.innerHTML = `
                    <h3>âš ï¸ å‘ç°æ—§ç‰ˆæœ¬æ–‡ä»¶</h3>
                    <p>éƒ¨åˆ†æ–‡ä»¶éœ€è¦æ›´æ–°ã€‚è¯·æŒ‰ç…§æŒ‡å—ä¸Šä¼ æœ€æ–°æ–‡ä»¶ã€‚</p>
                `;
                overallStatus.className = 'status-card warning';
            }
        }

        async function checkTimeCounter() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•æ—¶å…‰è®¡æ•°å™¨...</p>';
            
            try {
                // è®¡ç®—é¢„æœŸå€¼
                const loveStartDate = new Date('2024-04-05');
                const birthdayDate = new Date('2000-07-08');
                const now = new Date();
                
                const expectedLoveDays = Math.floor((now - loveStartDate) / (1000 * 60 * 60 * 24));
                
                const thisYear = now.getFullYear();
                let nextBirthday = new Date(thisYear, birthdayDate.getMonth(), birthdayDate.getDate());
                if (nextBirthday < now) {
                    nextBirthday = new Date(thisYear + 1, birthdayDate.getMonth(), birthdayDate.getDate());
                }
                const expectedBirthdayDays = Math.ceil((nextBirthday - now) / (1000 * 60 * 60 * 24));
                
                output.innerHTML = `
                    <div class="version-info">
â° æ—¶å…‰è®¡æ•°å™¨æµ‹è¯•ç»“æœï¼š
ğŸ“… å½“å‰æ—¥æœŸ: ${now.toLocaleDateString()}
â¤ï¸ é¢„æœŸç›¸æ‹å¤©æ•°: ${expectedLoveDays} å¤©
ğŸ‚ é¢„æœŸç”Ÿæ—¥å€’è®¡æ—¶: ${expectedBirthdayDays} å¤©

ğŸ’¡ å¦‚æœä¸»ç½‘ç«™æ˜¾ç¤ºçš„æ•°å­—ä¸ä¸Šè¿°ä¸ç¬¦ï¼Œè¯´æ˜æ—¶å…‰è®¡æ•°å™¨æœªæ­£å¸¸å·¥ä½œã€‚
   è¯·ç¡®ä¿ä¸Šä¼ äº†æœ€æ–°çš„ scripts/main.js æ–‡ä»¶ã€‚
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function checkAPI() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•APIè¿æ¥...</p>';
            
            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥
                const response = await fetch('/api/health', {
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    output.innerHTML = `
                        <div class="version-info">
ğŸ”— APIè¿æ¥æµ‹è¯•ç»“æœï¼š
âœ… åç«¯æœåŠ¡çŠ¶æ€: ${data.status}
ğŸ“ æœåŠ¡æ¶ˆæ¯: ${data.message}
ğŸŒ è¿æ¥æ­£å¸¸: æ˜¯

ğŸ’¡ åç«¯APIæœåŠ¡æ­£å¸¸è¿è¡Œã€‚å¦‚æœå‰ç«¯åŠŸèƒ½ä»ä¸å¯ç”¨ï¼Œ
   è¯·æ£€æŸ¥ scripts/api-data.js æ–‡ä»¶æ˜¯å¦å·²æ›´æ–°ã€‚
                        </div>
                    `;
                } else {
                    output.innerHTML = `<p>âŒ APIè¿æ¥å¤±è´¥: HTTP ${response.status}</p>`;
                }
            } catch (error) {
                output.innerHTML = `
                    <div class="version-info">
âŒ APIè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}

å¯èƒ½åŸå› ï¼š
1. åç«¯æœåŠ¡æœªè¿è¡Œ
2. ç½‘ç»œè¿æ¥é—®é¢˜  
3. æœåŠ¡å™¨é…ç½®é—®é¢˜

è¯·æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ã€‚
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” æ–‡ä»¶ç‰ˆæœ¬æ£€æŸ¥é¡µé¢åŠ è½½å®Œæˆ');
            
            // 5ç§’åè‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
            setTimeout(() => {
                checkAllFiles();
            }, 2000);
        });
    </script>
</body>
</html>
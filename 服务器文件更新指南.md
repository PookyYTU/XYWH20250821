# 🔧 服务器文件更新指南

## 问题描述
本地修复了网站功能问题，但服务器上的文件还是旧版本，需要将修复后的文件上传到服务器。

## ⚠️ 当前问题
- 时光计数器显示为0
- 美食、电影、日历、文件按钮无反应
- 服务器上的JavaScript文件不是最新版本

## 🎯 需要更新的文件

以下文件已在本地修复，需要上传到服务器：

### 1. 主要修复文件
```
本地路径 → 服务器路径
scripts/main.js → /www/wwwroot/xiaoyuweihan/scripts/main.js
scripts/api-data.js → /www/wwwroot/xiaoyuweihan/scripts/api-data.js
scripts/api.js → /www/wwwroot/xiaoyuweihan/scripts/api.js
index.html → /www/wwwroot/xiaoyuweihan/index.html
debug.html → /www/wwwroot/xiaoyuweihan/debug.html
```

## 📋 上传方法

### 方法1: 使用宝塔面板文件管理
1. 登录宝塔面板
2. 进入【文件】管理
3. 导航到 `/www/wwwroot/xiaoyuweihan/`
4. 分别上传以下文件，**覆盖**原有文件：
   - `scripts/main.js`
   - `scripts/api-data.js` 
   - `index.html`
   - `debug.html`

### 方法2: 使用FTP客户端
1. 连接到服务器 47.105.52.49
2. 进入网站根目录 `/www/wwwroot/xiaoyuweihan/`
3. 上传修复后的文件

### 方法3: 使用SSH命令（如果有服务器访问权限）
```bash
# 备份原文件
cp /www/wwwroot/xiaoyuweihan/scripts/main.js /tmp/main.js.backup
cp /www/wwwroot/xiaoyuweihan/scripts/api-data.js /tmp/api-data.js.backup
cp /www/wwwroot/xiaoyuweihan/scripts/api.js /tmp/api.js.backup

# 上传新文件后，设置正确权限
chown www:www /www/wwwroot/xiaoyuweihan/scripts/main.js
chown www:www /www/wwwroot/xiaoyuweihan/scripts/api-data.js
chown www:www /www/wwwroot/xiaoyuweihan/scripts/api.js
chown www:www /www/wwwroot/xiaoyuweihan/index.html
chown www:www /www/wwwroot/xiaoyuweihan/debug.html
```

## ✅ 验证修复效果

上传完成后，请：

1. **清除浏览器缓存**
   - 按 `Ctrl+F5` 强制刷新
   - 或在开发者工具中勾选"Disable cache"

2. **访问主网站**: http://47.105.52.49/
   - 时光计数器应显示正确天数（相恋天数应该是300+天）
   - 点击美食、电影、日历、文件按钮应有反应

3. **访问调试页面**: http://47.105.52.49/debug.html
   - 所有API测试应显示成功 ✅
   - 系统信息应显示服务已加载

4. **检查浏览器控制台** (F12 → Console)
   - 应看到详细的初始化日志
   - 应显示"小雨微寒应用初始化完成"

## 🔧 主要修复内容

### 1. 时光计数器修复
- 添加了DOM元素检查机制
- 增强了错误处理和调试信息
- 确保在元素准备好后才更新显示

### 2. 数据管理器加载优化  
- 改进了API服务和数据管理器的初始化流程
- 添加了等待机制，确保依赖正确加载
- 增强了调试信息输出

### 3. 前端功能按钮修复
- 修复了API连接问题
- 改进了错误处理机制
- 添加了重试逻辑

### 4. API连接配置说明
- 保持原有API连接配置不变
- 生产环境使用默认80端口（`http://${hostname}`）
- Nginx已配置将`/api/`路径请求代理到后端服务（`http://127.0.0.1:8000`）

## 📞 技术支持

如果上传后仍有问题，请：
1. 检查浏览器控制台错误信息
2. 确认文件上传成功且路径正确
3. 确保文件权限设置正确（owner: www）
4. 清除浏览器缓存后重试

---
*更新时间: 2025-08-26*
*修复版本: v1.1 - 时光计数器与API连接修复版*